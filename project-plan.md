## Project Plan: Visual Timer Web App

### 1. üìú Project Overview

* **Objective:** Create a minimalist, web-based timer app inspired by the visual "Time Timer". The app will be a single-page web application.
* **Core Concept:** A visual-first timer that shows time remaining as a solid-color "pie wedge" that shrinks as time elapses. The primary interaction is dragging on the timer face, not using buttons or text fields.
* **v1.0 Platform:** Web App (HTML, CSS, JavaScript).

---

### 2. üéØ Core Feature Requirements

#### Visual Display
* **Main Timer:** The timer MUST be rendered as a solid-color, filled "pie wedge" (an SVG `<path>`) that represents the remaining time.
* **Animation:** The wedge MUST animate by shrinking clockwise, from the set time (e.g., 25 minutes) down to 0.
* **Clock Face:** A static clock face MUST be displayed behind the time wedge. This face MUST include:
    * **Minute Ticks:** 60 small tick marks for each minute.
    * **5-Minute Ticks:** 12 larger tick marks for every 5-minute interval.
    * **Labels:** Numbers (5, 10, 15... 60) MUST be displayed at each 5-minute tick mark.
* **No Digital Display:** By default, there MUST NOT be a digital text countdown (e.g., "24:59").

#### Functional Interaction
* **Set Time (Drag):** The user MUST be able to set the timer by clicking and dragging (on desktop) or swiping (on touch) on the timer face. The visual wedge MUST update in real-time as the user drags.
* **Set Time (Manual):** The user MUST be able to double-click (or double-tap) the timer face to open a simple modal or input prompt to manually type in the desired minutes (1-60).
* **Start / Pause:** A single click (or tap) on the timer face MUST toggle the timer between "Start" and "Pause".
* **Audio Feedback:** When the timer completes, a pleasant chime or bell sound MUST play 2-3 times.

#### Snapping Logic (for Drag-to-Set)
* **Default Snapping:** By default, dragging MUST snap to the nearest **5-minute** increment (5, 10, 15, etc.).
* **Priority Snapping:** The snapping logic should have "stronger" snap points at **25** and **50** minutes, making it easy to set common Pomodoro times.
* **Fine-grained Snapping:** Implement a "fine-grained" mode. For example, if the user presses and **holds** for 1 second before dragging (or holds a modifier key like `Shift`), the snapping MUST change to 1-minute increments.

#### Customization
* **Color:** There MUST be a simple UI element (e.g., a small "settings" icon) that allows the user to change the color of the timer wedge.

---

### 3. üõ†Ô∏è Technical Specification (For Agent)

This section details the technical implementation plan.

#### `index.html` (DOM Structure)
* Create a main container `div.timer-container`.
* Inside, create a single `<svg>` element, set to `viewBox="0 0 100 100"` to maintain aspect ratio.
* **SVG Layers (in order, bottom to top):**
    1.  `<g id="clock-face">`: Group for static elements.
        * `<circle class="face-bg">`: A background circle.
        * A loop (generated by JS) will create 60 `<line class="tick-minute">` elements.
        * A loop (generated by JS) will create 12 `<line class="tick-hour">` elements.
        * A loop (generated by JS) will create 12 `<text class="label">` elements for numbers.
    2.  `<path id="time-wedge" d="">`: The dynamic "pie" wedge. Its `d` attribute will be controlled by JavaScript.
    3.  `<circle id="click-target" r="50" cx="50" cy="50" fill="transparent">`: An invisible top layer to capture all mouse/touch events reliably.

#### `styles.css` (Styling)
* Use CSS to make `.timer-container` centered and fill the viewport.
* Style the `.tick-minute`, `.tick-hour`, and `.label` elements (e.g., `stroke`, `stroke-width`, `font-size`, `fill`).
* The `#time-wedge` `fill` color should be set via a CSS Custom Property: `var(--timer-color)`.
* The `#click-target` MUST have `cursor: pointer`.

#### `script.js` (Core Logic)
* **State Variables:**
    * `let totalTime = 0;` (in seconds)
    * `let timeRemaining = 0;` (in seconds)
    * `let isRunning = false;`
    * `let timerInterval = null;`
    * `let dragMode = 'default';` ('default' or 'fine')

* **`init()` Function:**
    * Call `drawClockFace()` to generate SVG ticks and labels.
    * Attach event listeners (`mousedown`, `mousemove`, `mouseup`, `touchstart`, `touchmove`, `touchend`, `click`, `dblclick`) to the `#click-target` element.

* **`drawClockFace()` Function:**
    * Uses trigonometry to calculate (x, y) positions for 60 minute ticks and 12 five-minute ticks/labels and appends them to the `<g id="clock-face">`.

* **`drawWedge(seconds)` Function:**
    * **This is the core visual function.**
    * Converts `seconds` (0-3600) to an `angle` (0-359.9 degrees).
    * Calculates the (x, y) coordinates for the arc's end point using `Math.cos(angleInRadians)` and `Math.sin(angleInRadians)`.
        
    * Determines the `large-arc-flag` (1 if time > 30 min, 0 otherwise).
    * Constructs the SVG `d` path string (e.g., `M 50,50 L 50,0 A 50,50 [large-arc-flag] 1 [x],[y] Z`).
    * Sets the `d` attribute of the `#time-wedge` path.

* **Event Handlers:**
    * **`onDragStart` (`mousedown`/`touchstart`):**
        * Stop any running timer (`clearInterval`).
        * Record start time of press to detect "long-hold" for fine-grained snapping.
    * **`onDragMove` (`mousemove`/`touchmove`):**
        * Get cursor (x, y) relative to the SVG center.
        * Calculate the angle using `Math.atan2(y - 50, x - 50)`.
        * Convert angle to `seconds`.
        * Apply **Snapping Logic** (Priority > Default > Fine-grained) to get `snappedSeconds`.
        * Set `totalTime = snappedSeconds` and `timeRemaining = snappedSeconds`.
        * Call `drawWedge(timeRemaining)` for real-time visual feedback.
    * **`onClick` (`click`):**
        * Implement logic to differentiate from a `dblclick` (e.g., small `setTimeout`).
        * If `!isRunning`, call `startTimer()`.
        * If `isRunning`, call `pauseTimer()`.
    * **`onDoubleClick` (`dblclick`):**
        * `pauseTimer()`.
        * Show a `prompt()` box: "Enter minutes (1-60)".
        * Parse the value, convert to `seconds`, set `totalTime` and `timeRemaining`.
        * Call `drawWedge(timeRemaining)`.

* **Timer Control Functions:**
    * **`startTimer()`:**
        * Set `isRunning = true`.
        * Use `setInterval` (or `requestAnimationFrame`) to call a `tick()` function every second.
    * **`tick()`:**
        * `timeRemaining--`.
        * Call `drawWedge(timeRemaining)`.
        * If `timeRemaining <= 0`, call `endTimer()`.
    * **`pauseTimer()`:**
        * `isRunning = false`.
        * `clearInterval(timerInterval)`.
    * **`endTimer()`:**
        * `pauseTimer()`.
        * `timeRemaining = 0;`
        * Call `drawWedge(0)`.
        * Play the audio alert (`new Audio('chime.mp3').play()`).

---
